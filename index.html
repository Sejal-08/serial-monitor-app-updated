<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Serial Monitor</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
 
</head>

<body class="light-mode">
  <nav>
    <div class="logo">
      <img src="./build/logo.png" alt="Logo">
    </div>
    <ul class="nav-links">
      <li>
        <button class="theme-toggle" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </button>
      </li>
    </ul>
  </nav>

  <div class="main-container">
    <!-- ========= LEFT PANEL ========= -->
    <div class="left-panel">
      <section class="control-section">
        <h3><i class="fas fa-plug"></i> Serial Port</h3>
        <div class="controls">
          <button class="action-button" onclick="listPorts()"><i class="fas fa-list"></i> List Ports</button>
          <select id="ports" class="input-field"></select>
          <select id="baud-rate" class="input-field">
            <option value="9600">9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200" selected>115200</option>
            <option value="230400">230400</option>
          </select>
          <button class="action-button" onclick="connectPort()"><i class="fas fa-play"></i> Connect</button>
          <button class="action-button" onclick="disconnectPort()"><i class="fas fa-stop"></i> Disconnect</button>
        </div>
      </section>

      <section class="control-section">
        <h3><i class="fas fa-id-card"></i> Device ID Configuration</h3>
        <div class="controls">
          <input type="text" id="device-id" class="input-field" placeholder="Device ID (e.g., device-123)">
          <button class="action-button" onclick="setDeviceID()"><i class="fas fa-save"></i> Set Device ID</button>
        </div>
      </section>

      <section class="control-section">
        <h3><i class="fas fa-clock"></i> Interval Configuration</h3>
        <div class="controls">
          <input type="number" id="interval" class="input-field" placeholder="Interval (seconds)" min="1">
          <button class="action-button" onclick="setInterval()"><i class="fas fa-save"></i> Set Interval</button>
          <button class="action-button" onclick="getInterval()"><i class="fas fa-eye"></i> Get Interval</button>
        </div>
      </section>

      <section class="control-section">
        <div class="controls">
          <button id="restart-button" class="action-button" onclick="restartDevice()">
            <i class="fas fa-redo"></i> Restart Device
          </button>
        </div>
      </section>

      <!-- ===== PROTOCOL COLLAPSIBLE ===== -->
      <section class="control-section" id="protocol-section">
        <button class="collapsible">
          <span><i class="fas fa-exchange-alt"></i> Protocol Configuration</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="collapsible-content">
          <div class="controls">
            <select id="protocol-select" class="input-field" onchange="updateProtocolUI()">
              <option value="FTP">FTP</option>
              <option value="MQTT">MQTT</option>
              <option value="HTTP">HTTP</option>
            </select>
            <button class="action-button" onclick="setProtocol()"><i class="fas fa-save"></i> Set Protocol</button>
          </div>

          <!-- FTP -->
          <div id="ftp-section">
            <h3><i class="fas fa-cloud-upload-alt"></i> FTP Configuration</h3>
            <div class="controls">
              <input type="text" id="ftp-host" class="input-field" placeholder="Host (e.g., 13.126.194.224)">
            </div>
            <div class="controls">
              <input type="text" id="ftp-user" class="input-field" placeholder="User (e.g., iit_ropar)">
            </div>
            <div class="controls">
              <input type="password" id="ftp-password" class="input-field" placeholder="Password">
            </div>
            <div class="controls">
              <button class="action-button" onclick="setFTPConfig()"><i class="fas fa-save"></i> Set Config</button>
              <button class="action-button" onclick="getFTPConfig()"><i class="fas fa-eye"></i> Get FTP Config</button>
            </div>
            <div class="controls">
              <input type="text" id="upload-filename" class="input-field" placeholder="Filename (e.g., data1.json)">
              <button class="action-button" onclick="uploadFile()"><i class="fas fa-file-upload"></i> Upload File</button>
            </div>
          </div>

          <!-- MQTT -->
          <div id="mqtt-section" style="display: none;">
            <h3><i class="fas fa-comments"></i> MQTT Configuration</h3>
            <div class="controls">
              <input type="text" id="mqtt-broker" class="input-field" placeholder="Broker (e.g., a3qvnhplljfvjr-ats.iot.us-east-1.amazonaws.com)">
            </div>
            <div class="controls">
              <input type="number" id="mqtt-port" class="input-field" placeholder="Port (e.g., 1883)" value="1883">
            </div>
            <div class="controls">
              <input type="text" id="mqtt-user" class="input-field" placeholder="User">
            </div>
            <div class="controls">
              <input type="password" id="mqtt-password" class="input-field" placeholder="Password">
            </div>
            <div class="controls">
              <input type="text" id="mqtt-topic" class="input-field" placeholder="Topic (e.g., device/data)">
              <button class="action-button" onclick="setMQTTTopic()"><i class="fas fa-save"></i> Set Topic</button>
            </div>
            <div class="controls">
              <label for="mqtt-ssl">SSL/TLS Enabled:</label>
              <select id="mqtt-ssl" class="input-field" onchange="toggleCertUploadAndPort()">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </div>
            <div id="cert-section" style="display: none;">
              <div class="controls">
                <label>Device Certificate:</label>
                <input type="text" id="mqtt-ca-cert-path" class="input-field" placeholder="Path to certificate">
                <button class="action-button" onclick="browseCACert()"><i class="fas fa-folder-open"></i> Browse</button>
              </div>
              <div class="controls">
                <label>Private Key:</label>
                <input type="text" id="mqtt-client-key-path" class="input-field" placeholder="Path to private key">
                <button class="action-button" onclick="browseClientKey()"><i class="fas fa-folder-open"></i> Browse</button>
              </div>
            </div>
            <div class="controls">
              <button class="action-button" onclick="setMQTTConfig()"><i class="fas fa-save"></i> Set Config</button>
              <button class="action-button" onclick="getMQTTConfig()"><i class="fas fa-eye"></i> Get MQTT Config</button>
              <button class="action-button" id="cert-upload-button" onclick="uploadCertificates()" style="display: none;"><i class="fas fa-upload"></i> Upload Certificates</button>
            </div>
          </div>

          <!-- HTTP -->
          <div id="http-section" style="display: none;">
            <h3><i class="fas fa-globe"></i> HTTP Configuration</h3>
            <div class="controls">
              <input type="text" id="http-url" class="input-field" placeholder="URL (e.g., http://example.com/data )">
            </div>
            <div class="controls">
              <input type="text" id="http-auth-user" class="input-field" placeholder="Auth User">
              <input type="password" id="http-auth-password" class="input-field" placeholder="Auth Password">
            </div>
            <div class="controls">
              <button class="action-button" onclick="setHTTPConfig()"><i class="fas fa-save"></i> Set Config</button>
              <button class="action-button" onclick="getHTTPConfig()"><i class="fas fa-eye"></i> Get HTTP Config</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- ========= RIGHT PANEL ========= -->
    <div class="right-panel">
      <div class="container">
        <section class="control-section" id="sensors-section">
          <h3><i class="fas fa-microchip"></i> Sensor Protocols</h3>
          <div class="controls">
            <select id="sensor-select" class="input-field" onchange="updateSensorUI()">
              <option value="" disabled selected>Select a Sensor Protocol</option>
              <option value="I2C">I2C</option>
              <option value="ADC">ADC</option>
              <option value="RS232">RS232</option>
              <option value="RS485">RS485</option>
              <option value="SPI">SPI</option>
            </select>
          </div>

          <!-- sensor list -->
          <div id="sensor-list" class="sensor-list-container"></div>
        
          <div id="sensor-data" class="sensor-data-container"></div>  <!-- Add this line -->
          <!--  SENSOR CARDS  –  ALWAYS VISIBLE  -->
          <div class="sensor-cards">
            <!-- ... existing cards ... -->
          </div>

          <!--  SENSOR CARDS  –  ALWAYS VISIBLE  -->
          <div class="sensor-cards">
            <!-- Temperature -->
            <div id="thermometer-container" class="thermometer-container" style="display: none;">
              <h4>Temperature</h4>
              <div id="thermometer-value" class="sensor-value" style="margin-bottom: 8px;"></div>
              <svg width="100" height="220" viewBox="0 0 100 220" class="thermometer">
                <rect x="40" y="20" width="20" height="160" rx="10" ry="10" fill="#e0e7ff" stroke="#333" stroke-width="2"/>
                <rect id="thermometer-fill" x="42" y="180" width="16" height="0" rx="8" ry="8" fill="#ffeb3b"/>
                <circle cx="50" cy="180" r="10" fill="#e0e7ff" stroke="#333" stroke-width="2"/>
                <circle id="thermometer-bulb" cx="50" cy="180" r="8" fill="#ffeb3b"/>
                <line x1="65" y1="20"  x2="70"  y2="20"  stroke="#333" stroke-width="2"/><text x="75" y="25"  font-size="12" fill="var(--text-color)">50°C</text>
                <line x1="65" y1="52"  x2="70"  y2="52"  stroke="#333" stroke-width="1"/><text x="75" y="57"  font-size="12" fill="var(--text-color)">40°C</text>
                <line x1="65" y1="84"  x2="70"  y2="84"  stroke="#333" stroke-width="1"/><text x="75" y="89"  font-size="12" fill="var(--text-color)">30°C</text>
                <line x1="65" y1="116" x2="70"  y2="116" stroke="#333" stroke-width="1"/><text x="75" y="121" font-size="12" fill="var(--text-color)">20°C</text>
                <line x1="65" y1="148" x2="70"  y2="148" stroke="#333" stroke-width="1"/><text x="75" y="153" font-size="12" fill="var(--text-color)">10°C</text>
                <line x1="65" y1="180" x2="70"  y2="180" stroke="#333" stroke-width="2"/><text x="75" y="185" font-size="12" fill="var(--text-color)">0°C</text>
              </svg>
            </div>

            <!-- Humidity -->
            <div id="humidity-card" class="wave-card-container" style="display: none;">
              <h4>Humidity</h4>
              <div class="wave-card-content">
                <i class="fas fa-water-drop-outlined"></i>
                <span id="humidity-value" class="sensor-value"></span>
              </div>
              <svg id="humidity-wave" width="100%" height="80" viewBox="0 0 100 100" preserveAspectRatio="none">
                <defs>
                  <linearGradient id="waveGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" id="waveColor1" style="stop-color:#3d8eb4;stop-opacity:0.5"/>
                    <stop offset="100%" id="waveColor2" style="stop-color:#0474a8;stop-opacity:1"/>
                  </linearGradient>
                </defs>
                <path id="wavePath" d="M 0 100 V 100 H 100 V 100 Z" fill="url(#waveGradient)"/>
              </svg>
            </div>

            <!-- Pressure -->
            <div id="pressure-card" class="card-container" style="display: none;">
              <h4>Pressure</h4>
              <div id="pressure-value" class="sensor-value"></div>
              <div id="pressure-bar" class="card-bar"></div>
            </div>
   <!-- Light Intensity Card with Sun/Moon Toggle -->
            <div id="light-card" class="card-container" style="display: none; position: relative; border-radius: 15px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); padding: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
              <h4>Light Intensity</h4>
              <div id="light-value" class="sensor-value"></div>
              <!-- Sun SVG -->
              <svg id="light-sun" width="120" height="120" viewBox="0 0 120 120" style="display: none; margin: 10px auto;">
                <defs>
                  <radialGradient id="sunGradient" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#ffeb3b; stop-opacity:1"/>
                    <stop offset="60%" style="stop-color:#ff9800; stop-opacity:0.8"/>
                    <stop offset="100%" style="stop-color:#ff6b00; stop-opacity:0.4"/>
                  </radialGradient>
                  <filter id="sunGlow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge>
                      <feMergeNode in="coloredBlur"/>
                      <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                  </filter>
                </defs>
                <!-- Animated rays container -->
                <g id="sun-rays" transform="translate(60, 60)">
                  <line class="sun-ray" x1="0" y1="0" x2="0" y2="-40" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="-35;-50;-35" dur="4s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="28" y2="-28" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="0.5s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="24;34;24" dur="4s" begin="0.5s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="-24;-34;-24" dur="4s" begin="0.5s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="40" y2="0" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="1s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="35;50;35" dur="4s" begin="1s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="28" y2="28" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="1.5s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="24;34;24" dur="4s" begin="1.5s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="24;34;24" dur="4s" begin="1.5s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="0" y2="40" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="2s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="35;50;35" dur="4s" begin="2s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="-28" y2="28" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="2.5s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="-24;-34;-24" dur="4s" begin="2.5s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="24;34;24" dur="4s" begin="2.5s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="-40" y2="0" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="3s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="-35;-50;-35" dur="4s" begin="3s" repeatCount="indefinite"/>
                  </line>
                  <line class="sun-ray" x1="0" y1="0" x2="-28" y2="-28" stroke="#4b2e00" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" values="0;0.9;0" dur="4s" begin="3.5s" repeatCount="indefinite"/>
                    <animate attributeName="x2" values="-24;-34;-24" dur="4s" begin="3.5s" repeatCount="indefinite"/>
                    <animate attributeName="y2" values="-24;-34;-24" dur="4s" begin="3.5s" repeatCount="indefinite"/>
                  </line>
                </g>
                <!-- Central sun circle -->
                <circle id="sun-circle" cx="60" cy="60" r="24" fill="url(#sunGradient)" filter="url(#sunGlow)"/>
                <!-- Inner glow circle -->
                <circle cx="60" cy="60" r="24" fill="none" stroke="#fff" stroke-width="1" opacity="0.3">
                  <animate attributeName="r" values="24;28;24" dur="4s" repeatCount="indefinite"/>
                  <animate attributeName="opacity" values="0.3;0.1;0.3" dur="4s" repeatCount="indefinite"/>
                </circle>
              </svg>
              <!-- Moon SVG -->
              <svg id="light-moon" width="120" height="120" viewBox="0 0 120 120" style="display: none; margin: 10px auto;">
                <defs>
                  <radialGradient id="moonGradient" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#e6e6fa; stop-opacity:0.9"/>
                    <stop offset="70%" style="stop-color:#b0c4de; stop-opacity:0.6"/>
                    <stop offset="100%" style="stop-color:#4682b4; stop-opacity:0.3"/>
                  </radialGradient>
                  <filter id="moonGlow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                    <feMerge>
                      <feMergeNode in="coloredBlur"/>
                      <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                  </filter>
                </defs>
                <!-- Moon shape with crescent effect -->
                <path id="moon-shape" d="M60 20 A40 40 0 0 1 60 100 A40 40 0 0 1 60 20 C80 30 80 90 60 100" fill="url(#moonGradient)" filter="url(#moonGlow)"/>
                <!-- Sparkles for moon -->
                <g id="moon-sparkles">
                  <circle cx="40" cy="40" r="2" fill="#fff" opacity="0">
                    <animate attributeName="opacity" values="0;0.7;0" dur="2s" repeatCount="indefinite"/>
                    <animate attributeName="r" values="2;3;2" dur="2s" repeatCount="indefinite"/>
                  </circle>
                  <circle cx="80" cy="80" r="2" fill="#fff" opacity="0">
                    <animate attributeName="opacity" values="0;0.7;0" dur="2.5s" begin="0.5s" repeatCount="indefinite"/>
                    <animate attributeName="r" values="2;3;2" dur="2.5s" begin="0.5s" repeatCount="indefinite"/>
                  </circle>
                  <circle cx="50" cy="70" r="2" fill="#fff" opacity="0">
                    <animate attributeName="opacity" values="0;0.7;0" dur="3s" begin="1s" repeatCount="indefinite"/>
                    <animate attributeName="r" values="2;3;2" dur="3s" begin="1s" repeatCount="indefinite"/>
                  </circle>
                </g>
              </svg>
            </div>

<div id="battery-card" class="card-container" style="display: none; position: relative; padding: 15px; text-align: center;">
  <h4>Battery Voltage</h4>
  <div id="battery-value" class="sensor-value" style="margin-bottom: 10px;"></div>
  <div style="display: inline-block;">
    <svg id="battery-icon" width="80" height="100" viewBox="0 0 80 100">
      <rect x="20" y="20" width="40" height="70" rx="5" ry="5" fill="#e0e7ff" stroke="#333" stroke-width="2"/>
      <rect x="30" y="10" width="20" height="10" fill="#e0e7ff" stroke="#333" stroke-width="2"/>
      <rect id="battery-fill" x="22" y="20" width="36" height="0" rx="4" ry="4" fill="#34d399"/>
    </svg>
  </div>
</div>
<!-- Rain Gauge Card -->
<div id="rain-gauge-card" class="wave-card-container" style="display: none;">
  <h4>Total Rainfall</h4>
  <div class="wave-card-content">
    <i class="fas fa-cloud-rain"></i>
    <span id="rain-gauge-value" class="sensor-value"></span>
  </div>
  <svg id="rain-wave" width="100%" height="80" viewBox="0 0 100 100" preserveAspectRatio="none">
    <defs>
      <linearGradient id="rainGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" id="rainColor1" style="stop-color:#1e90ff;stop-opacity:0.5"/>
        <stop offset="100%" id="rainColor2" style="stop-color:#1e90ff;stop-opacity:1"/>
      </linearGradient>
    </defs>
    <path id="rainPath" d="M 0 100 V 100 H 100 V 100 Z" fill="url(#rainGradient)"/>
  </svg>
</div>
          </div>
        </section>

        <section class="control-section">
          <h3><i class="fas fa-file-alt"></i> UART Logs</h3>
          <div class="controls">
            <button class="action-button" onclick="clearOutput()"><i class="fas fa-trash"></i> Clear Logs</button>
          </div>
          <div id="output"></div>
        </section>
      </div>
    </div>
  </div>

  <footer>
    <p><i class="fas fa-copyright"></i> Serial Monitor App © 2025</p>
  </footer>

  <script src="renderer.js"></script>
  <script>
    let isLedOn = false;

    async function restartDevice() {
  const res = await window.electronAPI.sendData('RESTART');
  const output = document.getElementById('output');
  if (res.error) {
    output.innerHTML += `<span class="log-line log-error">Failed to send RESTART command: ${res.error}</span><br>`;
  } else {
    output.innerHTML += `<span class="log-line log-success">Sent RESTART command to device.</span><br>`;
  }
  output.scrollTop = output.scrollHeight;
  const button = document.getElementById('restart-button');
  button.disabled = true;
  setTimeout(() => {
    button.disabled = false;
  }, 5000);
}

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      const icon = document.querySelector('.theme-toggle i');
      icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
    }

    function clearOutput() {
      document.getElementById('output').innerHTML = '';
    }

    document.querySelector('.collapsible').addEventListener('click', function() {
      this.classList.toggle('active');
      const content = this.nextElementSibling;
      content.classList.toggle('active');
    });

    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.querySelector('.theme-toggle i').className = 'fas fa-sun';
    }
  </script>
</body>
</html>